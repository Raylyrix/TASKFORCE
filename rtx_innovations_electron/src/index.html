<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TASK FORCE - AutoMailer Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Inline critical CSS for immediate loading */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            overflow-x: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: #ffffff;
            border-right: 1px solid #e5e5e7;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f5f5f7;
        }
        
        .header {
            background: #ffffff;
            padding: 20px 30px;
            border-bottom: 1px solid #e5e5e7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .mailer-interface {
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #1d1d1f;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: #007AFF;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056CC;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #f2f2f7;
            color: #1d1d1f;
            border: 1px solid #e5e5e7;
        }
        
        .btn-secondary:hover {
            background: #e5e5ea;
            border-color: #d1d1d6;
        }
        
        .btn-success {
            background: #34C759;
            color: white;
        }
        
        .btn-success:hover {
            background: #28A745;
        }
        
        .btn-danger {
            background: #FF3B30;
            color: white;
        }
        
        .btn-danger:hover {
            background: #DC3545;
        }
        
        /* Toolbar button active states */
        .toolbar-group button.active {
            background: #007AFF !important;
            color: white !important;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }
        
        .toolbar-group button.active:hover {
            background: #0056CC !important;
        }
        
        /* Tab styles */
        .tab-container {
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .tab-header {
            background: #f8f9fa;
            border-bottom: 1px solid #e5e5e7;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tab-title {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0;
        }
        
        .tab-actions {
            display: flex;
            gap: 8px;
        }
        
        .tab-list {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e5e7;
            overflow-x: auto;
        }
        
        .tab-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            user-select: none;
            position: relative;
        }
        
        .tab-item:hover {
            background: #f8f9fa;
        }
        
        .tab-item.active {
            border-bottom-color: #007AFF;
            background: #ffffff;
        }
        
        .tab-item .tab-close {
            margin-left: 8px;
            padding: 2px 6px;
            border-radius: 50%;
            background: #e5e5e7;
            color: #8E8E93;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tab-item .tab-close:hover {
            background: #ff3b30;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Status indicators */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-indicator.connected {
            background: #34C759;
        }
        
        .status-indicator.disconnected {
            background: #FF3B30;
        }
        
        .status-indicator.connecting {
            background: #FF9500;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Table styles */
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
        }
        
        .table-container table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table-container th,
        .table-container td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e5e5e7;
        }
        
        .table-container th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1d1d1f;
        }
        
        .table-container tr:hover {
            background: #f8f9fa;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: fixed;
                top: 0;
                left: -100%;
                transition: left 0.3s ease;
                z-index: 1000;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mailer-interface {
                padding: 20px;
                margin: 0;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-success {
            background: #34C759;
        }
        
        .notification-error {
            background: #FF3B30;
        }
        
        .notification-warning {
            background: #FF9500;
            border-left: 4px solid #fd7e14;
        }
        
        .notification-info {
            background: #007AFF;
            border-left: 4px solid #0056CC;
        }
        
        .notification:hover {
            transform: translateX(0);
        }
        
        .notification .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.8;
        }
        
        .notification .close-btn:hover {
            opacity: 1;
        }
        
        .data-preview {
            margin-top: 20px;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .campaigns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .campaign-card {
            background: white;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            padding: 20px;
        }
        
        .campaign-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.running {
            background: #FF9500;
            color: white;
        }
        
        .status-badge.completed {
            background: #34C759;
            color: white;
        }
        
        .status-badge.draft {
            background: #8E8E93;
            color: white;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e5e5e7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #8E8E93;
        }

        /* Authentication styles */
        .auth-options {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .auth-option {
            text-align: center;
            padding: 24px;
            border: 2px solid #f2f2f7;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .auth-option:hover {
            border-color: #007AFF;
            background: #f8f9fa;
        }

        .auth-option h4 {
            margin: 0 0 12px 0;
            color: #1d1d1f;
            font-size: 18px;
        }

        .auth-option p {
            margin: 0 0 20px 0;
            color: #666;
            line-height: 1.5;
        }

        .auth-divider {
            position: relative;
            text-align: center;
            margin: 16px 0;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e5e5e7;
        }

        .auth-divider span {
            background: white;
            padding: 0 16px;
            color: #8E8E93;
            font-size: 14px;
        }

        .credentials-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        #selectedFileName {
            min-height: 20px;
            font-style: italic;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8E8E93;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        /* Tab Management Styles */
        .tab-container {
            background: #ffffff;
            border-bottom: 1px solid #e5e5e7;
            padding: 0 30px;
        }
        
        .tab-list {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            border-bottom: 1px solid #e5e5e7;
        }
        
        .tab-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            user-select: none;
            position: relative;
        }
        
        .tab-item:hover {
            background: #f8f9fa;
        }
        
        .tab-item.active {
            border-bottom-color: #007AFF;
            background: #ffffff;
        }
        
        .tab-item .tab-close {
            margin-left: 8px;
            padding: 2px 6px;
            border-radius: 50%;
            background: #e5e5e7;
            color: #8E8E93;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tab-item .tab-close:hover {
            background: #ff3b30;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .add-tab-btn {
            padding: 12px 16px;
            background: #f2f2f7;
            border: 1px dashed #c7c7cc;
            border-radius: 8px;
            color: #8E8E93;
            cursor: pointer;
            margin: 8px 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-tab-btn:hover {
            background: #e5e5e7;
            border-color: #8E8E93;
            color: #1d1d1f;
        }
        
        .tab-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .tab-title {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
        }
        
        .tab-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Dark Theme Support */
        body.theme-dark {
            background: #1d1d1f;
            color: #f5f5f7;
        }
        
        body.theme-dark .header,
        body.theme-dark .tab-container {
            background: #2c2c2e;
            border-color: #3a3a3c;
        }
        
        body.theme-dark .mailer-interface {
            background: #2c2c2e;
            color: #f5f5f7;
        }
        
        body.theme-dark .form-group label {
            color: #f5f5f7;
        }
        
        body.theme-dark .form-group input,
        body.theme-dark .form-group textarea,
        body.theme-dark .form-group select {
            background: #3a3a3c;
            border-color: #48484a;
            color: #f5f5f7;
        }
        
        body.theme-dark .btn-secondary {
            background: #3a3a3c;
            color: #f5f5f7;
            border-color: #48484a;
        }
        
        body.theme-dark .btn-secondary:hover {
            background: #48484a;
        }
        
        /* Enhanced Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-success {
            background: #34C759;
            border-left: 4px solid #28a745;
        }
        
        .notification-error {
            background: #FF3B30;
            border-left: 4px solid #dc3545;
        }
        
        .notification-warning {
            background: #FF9500;
            border-left: 4px solid #fd7e14;
        }
        
        .notification-info {
            background: #007AFF;
            border-left: 4px solid #0056CC;
        }
        
        .notification:hover {
            transform: translateX(0);
        }
        
        .notification .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.8;
        }
        
        .notification .close-btn:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
	<div class="app-container" style="display:block; height:auto; min-height:100vh;">
				<!-- Tab Management - Above Navbar -->
		<div class="tab-container" style="position: sticky; top:0; z-index:20; background:#fff; border-bottom:1px solid #e5e5e7; padding:8px 16px;">
			<div style="display:flex; align-items:center; justify-content:space-between;">
				<ul class="tab-list" id="tabList" style="display:flex; list-style:none; margin:0; padding:0; gap:8px;">
					<li class="tab-item active" data-tab="tab1" style="padding:8px 16px; background:#007AFF; color:#fff; border-radius:6px; cursor:pointer; display:flex; align-items:center; gap:8px;">
						Campaign 1
						<span class="tab-close" onclick="window.rtxApp.closeTab('tab1')" style="cursor:pointer; font-weight:bold;">&times;</span>
					</li>
				</ul>
				<div class="add-tab-btn" onclick="window.rtxApp.addNewTab()" style="padding:8px 16px; background:#34C759; color:#fff; border-radius:6px; cursor:pointer; display:flex; align-items:center; gap:8px;">
					<i class="fas fa-plus"></i>
					Add New Campaign Tab
				</div>
			</div>
		</div>
		
		<!-- Top Navigation Bar -->
		<div class="header" style="position: sticky; top:0; z-index:10; background:#fff; border-bottom:1px solid #e5e5e7; display:flex; align-items:center; justify-content:space-between; padding:10px 16px;">
			<div style="display:flex; align-items:center; gap:12px;">
				<h1 style="font-size:18px; margin:0;">TASK FORCE</h1>
				<p style="color:#8E8E93; margin:0; font-size:12px;">Send bulk emails with Google Sheets integration</p>
			</div>
			<div style="display:flex; gap:8px; align-items:center; position:relative;">
				<button id="googleSignInTopBtn" class="btn btn-secondary" style="border-radius:6px; border:1px solid #d0d0d4; color:#2c2c2e; background:#fff;">Sign in with Google</button>
				<button id="googleLogoutBtn" class="btn btn-secondary" style="border-radius:6px; border:1px solid #d0d0d4; color:#2c2c2e; background:#fff; display:none;">Logout</button>
                <select id="accountsSelect" style="min-width:220px; padding:8px 10px; border:1px solid #e5e5e7; border-radius:6px;">
                    <option value="">Select account</option>
                </select>
                <button class="btn btn-secondary" id="loginBtn"><i class="fas fa-sign-in-alt"></i>Login</button>
				<button class="btn btn-secondary" id="importSheetBtn"><i class="fas fa-file-import"></i>Import</button>
				<button class="btn btn-secondary" id="togglePreviewBtn"><i class="fas fa-table"></i>Preview</button>
				<button class="btn btn-secondary" id="logsBtn"><i class="fas fa-list"></i>Logs</button>
				<button class="btn btn-secondary" id="themeToggle"><i class="fas fa-moon"></i>Theme</button>
				<button class="btn btn-secondary" id="helpToolbarBtn"><i class="fas fa-circle-question"></i>Help</button>
				<div id="helpDropdown" style="display:none; position:absolute; right:0; top:100%; margin-top:8px; background:#ffffff; border:1px solid #e5e5e7; border-radius:8px; box-shadow: 0 6px 16px rgba(0,0,0,0.12); overflow:hidden; min-width:220px;">
					<button class="btn btn-secondary" id="helpCheckBtn" style="display:block; width:100%; text-align:left; border-radius:0; padding:10px 12px;">Check for Updates</button>
					<button class="btn btn-secondary" id="helpWelcomeBtn" style="display:block; width:100%; text-align:left; border-radius:0; padding:10px 12px;">Welcome</button>
					<button class="btn btn-secondary" id="helpReleaseNotesBtn" style="display:block; width:100%; text-align:left; border-radius:0; padding:10px 12px;">Release Notes</button>
					<button class="btn btn-secondary" id="helpAboutBtn" style="display:block; width:100%; text-align:left; border-radius:0; padding:10px 12px;">About</button>
				</div>
                </div>
            </div>
            
		<div class="main-content" style="width:100%;">
			<div class="content-area" style="padding:16px;">
				<!-- Tab 1 Content -->
				<div id="tab1" class="tab-content active">
				<div class="mailer-interface" style="max-width:unset; width:100%;">
						<div class="tab-header">
							<h2 class="tab-title">Email Campaign Manager</h2>
							<div class="tab-actions">
								<button class="btn btn-secondary" id="importSheetBtn1"><i class="fas fa-file-import"></i>Import Spreadsheet</button>
								<button class="btn btn-secondary" id="togglePreviewBtn1"><i class="fas fa-table"></i>Toggle Data Preview</button>
								<button class="btn btn-secondary" id="logsBtn1"><i class="fas fa-list"></i>Logs</button>
							</div>
						</div>
					<h2 style="margin-bottom: 16px; color: #1d1d1f;">Email Campaign Manager</h2>
					<div style="display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap;">
						<!-- These buttons now live in the top bar, keeping here for keyboard access if needed -->
						<button class="btn btn-secondary" id="importSheetBtn" style="display:none;"><i class="fas fa-file-import"></i>Import Spreadsheet</button>
						<button class="btn btn-secondary" id="togglePreviewBtn" style="display:none;"><i class="fas fa-table"></i>Toggle Data Preview</button>
						<button class="btn btn-secondary" id="logsBtn" style="display:none;"><i class="fas fa-list"></i>Logs</button>
            </div>
            
					<!-- Account and From -->
					<div style="display:grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
						<div style="background:#f2f2f7; padding: 12px 16px; border-radius:8px; display:flex; align-items:center; gap:10px;">
							<div class="status-indicator disconnected" id="authStatus"></div>
							<span id="accountStatus">Not Connected</span>
                    </div>
						<div class="form-group" style="margin:0;">
							<label>From Address <span id="signatureInfo" style="color:#8E8E93; font-weight:400; font-size:12px; margin-left:6px;"></span></label>
							<select id="fromAddress"></select>
							<div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
								<input type="text" id="fromOverride" placeholder="Or type a custom From email" style="flex:1;">
								<small style="color:#8E8E93;">Use a verified alias for best deliverability</small>
                    </div>
                </div>
            </div>

					<!-- Google OAuth Authentication -->
					<div style="margin-bottom: 16px; padding: 16px; background: #f2f2f7; border-radius: 8px;">
						<h3 style="margin-bottom: 10px;"><i class="fas fa-shield-alt"></i> Google Authentication</h3>
						<p style="margin-bottom: 12px; color: #666;">Connect your Google account to access Gmail and Google Sheets:</p>
						<div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
							<button id="googleLoginBtn" class="btn btn-primary">
								<i class="fab fa-google"></i> Sign in with Google
							</button>
							<div style="display: flex; align-items: center; gap: 8px;">
								<span style="color: #666;">or</span>
								<div style="display: flex; flex-direction: column; gap: 4px;">
									<input type="file" id="credentialsFile" accept=".json" style="display: none;">
									<button id="uploadCredentialsBtn" class="btn btn-secondary">
										<i class="fas fa-upload"></i> Upload Credentials
									</button>
									<small style="color: #8E8E93; font-size: 11px;">Upload your Google API credentials JSON file</small>
								</div>
                    </div>
                </div>
            </div>

					<div id="dataPreviewDrawer" style="display:none; position:relative; border:1px solid #e5e5e7; border-radius:8px; padding:12px; margin-bottom:16px; background:#fff; z-index:1000;">
						<div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px;">
							<div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
								<strong>Sheet Data Preview</strong>
								<input type="text" id="placeholderSearch" placeholder="Search columns..." style="padding:8px 12px; border:1px solid #ddd; border-radius:6px; min-width:180px;">
								<select id="previewPosition" style="padding:8px 12px; border:1px solid #ddd; border-radius:6px;">
									<option value="top">Top</option>
									<option value="bottom">Bottom</option>
									<option value="left">Left</option>
									<option value="right">Right</option>
								</select>
								<button class="btn btn-secondary" id="previewFullscreenBtn"><i class="fas fa-expand"></i>Fullscreen</button>
                </div>
							<button class="btn btn-secondary" id="closePreviewBtn"><i class="fas fa-times"></i></button>
                </div>
						<div id="previewTableZone" class="table-container"></div>
                    </div>
                    
					<!-- Google Sheets Connection -->
					<div style="margin-bottom: 16px; padding: 16px; background: #f2f2f7; border-radius: 8px;">
						<h3 style="margin-bottom: 10px;">Step 1: Connect Google Sheets</h3>
						<div class="form-group" style="margin-bottom:10px;">
							<label>Google Sheets URL</label>
							<input type="text" id="sheetUrlInput" placeholder="https://docs.google.com/spreadsheets/d/...">
                            </div>
						<div id="sheetTabsContainer" class="form-group" style="margin-bottom:10px;"></div>
						<div style="display:flex; gap:8px; flex-wrap:wrap;">
							<button class="btn btn-primary" id="connectSheetsBtn2">
								<i class="fas fa-link"></i>Connect Sheets
							</button>
							<button class="btn btn-secondary" id="refreshSheetsBtn" disabled>
								<i class="fas fa-sync"></i>Refresh Data
							</button>
							<button class="btn btn-secondary" id="importLocalSheetBtn">
								<i class="fas fa-file-import"></i>Import Local File
							</button>
						</div>
						<div id="sheetsData" style="display: none; margin-top: 12px;"></div>
                        </div>
                        
					<!-- Email Campaign Form -->
					<div style="margin-bottom: 16px;">
						<h3 style="margin-bottom: 10px;">Step 2: Create Email Campaign</h3>
						<div class="form-group">
							<label>Campaign Name</label>
							<input type="text" id="campaignName" placeholder="Enter campaign name">
                            </div>
							
						<!-- Email Preview Section -->
						<div class="form-group" style="margin-bottom: 20px;">
							<label style="display: flex; align-items: center; justify-content: space-between;">
								<span>Email Preview</span>
								<button type="button" class="btn btn-secondary" id="refreshPreviewBtn" style="font-size: 12px;">
									<i class="fas fa-sync-alt"></i> Refresh Preview
								</button>
							</label>
							<div id="emailPreview" style="border: 1px solid #e5e5e7; border-radius: 6px; padding: 16px; background: #f8f9fa; min-height: 200px; max-height: 400px; overflow-y: auto;">
								<div style="text-align: center; color: #8E8E93; padding: 40px 20px;">
									<i class="fas fa-eye" style="font-size: 32px; margin-bottom: 16px; display: block;"></i>
									<p>Preview will appear here after you fill in the campaign details</p>
									<small>Click "Refresh Preview" to update the preview with current content</small>
								</div>
							</div>
                            </div>
						<div class="form-group">
							<label>Subject Line</label>
							<div style="display: flex; gap: 8px; align-items: center;">
								<input type="text" id="campaignSubject" placeholder="Enter email subject" style="flex: 1;">
								<button type="button" class="btn btn-secondary" id="subjectPlaceholdersBtn" style="white-space: nowrap;">
									<i class="fas fa-tags"></i> Placeholders
								</button>
							</div>
                            </div>
						<div class="form-group">
							<label>From Name</label>
							<input type="text" id="fromName" placeholder="Your name">
                        </div>
						<div class="form-group">
							<label style="display:flex; align-items:center; justify-content:space-between;">
								<span>Email Content</span>
								<span style="font-size:12px; color:#8E8E93;">Click any column chip or cell to insert placeholders</span>
							</label>
                            <div id="emailEditorContainer" style="border:1px solid #e1e5e9; border-top:none; border-radius:0 0 12px 12px; min-height:400px; background:#fff; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow:hidden;">
                                <!-- Editor Header Bar -->
                                <div style="background:#f8f9fa; border-bottom:1px solid #e1e5e9; padding:8px 16px; display:flex; align-items:center; gap:12px; font-size:13px; color:#5f6368;">
                                    <div style="display:flex; align-items:center; gap:8px;">
                                        <i class="fas fa-edit" style="color:#1a73e8;"></i>
                                        <span style="font-weight:500;">Rich Text Editor</span>
                                    </div>
                                    <div style="height:16px; width:1px; background:#dadce0;"></div>
                                    <span id="editorStatus" style="color:#34a853;">Ready</span>
                                    <div style="margin-left:auto; display:flex; align-items:center; gap:8px;">
                                        <button type="button" id="wordCountBtn" style="background:none; border:none; color:#5f6368; font-size:12px; cursor:pointer; padding:4px 8px; border-radius:4px;" title="Word Count">
                                            <span id="wordCount">0 words</span>
                                        </button>
                                        <button type="button" id="charCountBtn" style="background:none; border:none; color:#5f6368; font-size:12px; cursor:pointer; padding:4px 8px; border-radius:4px;" title="Character Count">
                                            <span id="charCount">0 chars</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Enhanced Toolbar -->
                                <div style="background:#fff; border-bottom:1px solid #e1e5e9; padding:12px 16px; display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
                                    <!-- Text Formatting -->
                                    <div class="toolbar-group" style="display:flex; align-items:center; gap:4px; padding:4px; border-radius:6px; background:#f8f9fa;">
                                        <select id="fontFamily" style="padding:6px 8px; border:1px solid #dadce0; border-radius:4px; font-size:13px; background:#fff; min-width:120px;">
                                            <option value="Arial, sans-serif">Arial</option>
                                            <option value="'Times New Roman', serif">Times New Roman</option>
                                            <option value="'Courier New', monospace">Courier New</option>
                                            <option value="Georgia, serif">Georgia</option>
                                            <option value="Verdana, sans-serif">Verdana</option>
                                            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
									</select>
                                        <select id="fontSize" style="padding:6px 8px; border:1px solid #dadce0; border-radius:4px; font-size:13px; background:#fff; min-width:60px;">
                                            <option value="1">8pt</option>
                                            <option value="2">10pt</option>
                                            <option value="3" selected>12pt</option>
                                            <option value="4">14pt</option>
                                            <option value="5">16pt</option>
                                            <option value="6">18pt</option>
                                            <option value="7">24pt</option>
									</select>
							</div>

                                    <div class="toolbar-group" style="display:flex; align-items:center; gap:2px; padding:4px; border-radius:6px; background:#f8f9fa;">
                                        <button type="button" id="boldBtn" title="Bold (Ctrl+B)" onclick="formatText('bold')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">B</button>
                                        <button type="button" id="italicBtn" title="Italic (Ctrl+I)" onclick="formatText('italic')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-style:italic; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">I</button>
                                        <button type="button" id="underlineBtn" title="Underline (Ctrl+U)" onclick="formatText('underline')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; text-decoration:underline; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">U</button>
                                    </div>

                                    <div class="toolbar-group" style="display:flex; align-items:center; gap:2px; padding:4px; border-radius:6px; background:#f8f9fa;">
                                        <button type="button" id="strikeBtn" title="Strikethrough" onclick="formatText('strikeThrough')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; text-decoration:line-through; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">S</button>
                                        <button type="button" id="superscriptBtn" title="Superscript" onclick="execCommand('superscript')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">X²</button>
                                        <button type="button" id="subscriptBtn" title="Subscript" onclick="execCommand('subscript')" style="padding:8px; border:none; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'">X₂</button>
                                    </div>

                                    <div class="toolbar-group" style="display:flex; align-items:center; gap:2px; padding:4px; border-radius:6px; background:#f8f9fa;">
                                        <button type="button" id="alignLeftBtn" title="Align Left" onclick="execCommand('justifyLeft')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-align-left"></i></button>
                                        <button type="button" id="alignCenterBtn" title="Align Center" onclick="execCommand('justifyCenter')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-align-center"></i></button>
                                        <button type="button" id="alignRightBtn" title="Align Right" onclick="execCommand('justifyRight')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-align-right"></i></button>
                                        <button type="button" id="justifyBtn" title="Justify" onclick="execCommand('justifyFull')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-align-justify"></i></button>
                                    </div>

                                    <div class="toolbar-group" style="display:flex; align-items:center; gap:2px; padding:4px; border-radius:6px; background:#f8f9fa;">
                                        <button type="button" id="listUlBtn" title="Bullet List" onclick="execCommand('insertUnorderedList')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-list-ul"></i></button>
                                        <button type="button" id="listOlBtn" title="Numbered List" onclick="execCommand('insertOrderedList')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-list-ol"></i></button>
                                        <button type="button" id="blockquoteBtn" title="Blockquote" onclick="execCommand('formatBlock')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-quote-right"></i></button>
                                    </div>

                                    <div class="toolbar-group" style="display:flex; align-items:center; gap:2px; padding:4px; border-radius:6px; background:#f8f9fa;">
                                        <button type="button" id="linkBtn" title="Insert Link (Ctrl+K)" onclick="insertLink().catch(console.error)" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-link"></i></button>
                                        <button type="button" id="imageBtn" title="Insert Image" onclick="insertImage().catch(console.error)" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-image"></i></button>
                                        <button type="button" id="tableBtn" title="Insert Table" onclick="insertTable().catch(console.error)" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-table"></i></button>
                                        <button type="button" id="hrBtn" title="Insert Horizontal Rule" onclick="execCommand('insertHorizontalRule')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-minus"></i></button>
                                    </div>

                                    <div class="toolbar-group" style="display:flex; align-items:center; gap:2px; padding:4px; border-radius:6px; background:#f8f9fa;">
                                        <button type="button" id="undoBtn" title="Undo (Ctrl+Z)" onclick="execCommand('undo')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-undo"></i></button>
                                        <button type="button" id="redoBtn" title="Redo (Ctrl+Y)" onclick="execCommand('redo')" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-redo"></i></button>
                                        <button type="button" id="clearFormatBtn" title="Clear Formatting" onclick="clearFormatting()" style="padding:8px; border:none; background:#fff; border-radius:4px; cursor:pointer; min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; color:#5f6368; transition:all 0.2s;" onmouseover="this.style.background='#f1f3f4'" onmouseout="this.style.background='#fff'"><i class="fas fa-eraser"></i></button>
                                    </div>
                                </div>

                                                                 <!-- Editor Content Area -->
                                 <div id="emailEditor" contenteditable="true" style="padding:24px; min-height:300px; outline:none; font-family:'Segoe UI', Arial, sans-serif; font-size:14px; line-height:1.6; color:#202124; border-radius:0; background:#fff; position:relative;" data-placeholder="Start typing your email content here... Type @ to see available placeholders"></div>
                                 
                                 <!-- Placeholder Dropdown -->
                                 <div id="placeholderDropdown" style="display:none; position:absolute; background:white; border:1px solid #e5e5e7; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.15); max-height:200px; overflow-y:auto; z-index:1000; min-width:200px;">
                                     <div style="padding:8px 12px; background:#f8f9fa; border-bottom:1px solid #e5e5e7; font-weight:600; color:#1d1d1f;">
                                         <i class="fas fa-tags"></i> Available Placeholders
                                     </div>
                                     <div id="placeholderList" style="padding:8px 0;">
                                         <!-- Placeholders will be populated here -->
                                     </div>
                                 </div>



                                <!-- Editor Footer -->
                                <div style="background:#f8f9fa; border-top:1px solid #e1e5e9; padding:8px 16px; display:flex; align-items:center; justify-content:space-between; font-size:12px; color:#5f6368;">
                                    <div style="display:flex; align-items:center; gap:16px;">
                                        <span>Format: Rich Text (HTML)</span>
                                        <span id="editorMode">Standard Mode</span>
                                    </div>
                                    <div style="display:flex; align-items:center; gap:8px;">
                                        <button type="button" id="toggleModeBtn" style="background:none; border:1px solid #dadce0; border-radius:4px; padding:4px 8px; font-size:11px; cursor:pointer; color:#5f6368;" onclick="toggleEditorMode()">Toggle Mode</button>
                                        <button type="button" id="clearFormatBtn" style="background:none; border:1px solid #dadce0; border-radius:4px; padding:4px 8px; font-size:11px; cursor:pointer; color:#5f6368;" onclick="clearFormatting()">Clear Format</button>
                                    </div>
                                </div>
                            </div>
                        </div>
						<div id="placeholderAssistant" class="form-group" style="margin-top:-6px;">
							<div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
								<input type="text" id="assistantSearch" placeholder="Search placeholders..." style="padding:8px 12px; border:1px solid #ddd; border-radius:6px; min-width:180px;">
								<div id="assistantChips" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
                            </div>
                        </div>
						<div style="display:flex; align-items:center; gap:12px; margin-bottom: 10px; flex-wrap:wrap;">
							<label style="display:flex; align-items:center; gap:8px;">
								<input type="checkbox" id="useSignature"> Include Gmail Signature
							</label>
							<button class="btn btn-secondary" id="previewEmailBtn"><i class="fas fa-eye"></i>Preview</button>
                            </div>
						<div class="form-group">
							<label style="display: flex; align-items: center; gap: 8px;">
								<span>📎 Attachments (Required by Default)</span>
								<label style="font-size: 12px; font-weight: normal; color: #8E8E93; margin-left: auto;">
									<input type="checkbox" id="sendWithoutAttachments" style="margin-right: 4px;">
									Send without attachments
								</label>
							</label>
							<div id="campaignAttachments" style="border: 1px solid #e5e5e7; border-radius: 6px; padding: 12px; background: #f8f9fa; min-height: 80px;">
								<div style="text-align: center; color: #8E8E93;">
									<i class="fas fa-paperclip" style="font-size: 20px; margin-bottom: 8px; display: block;"></i>
									<p>No attachments selected</p>
									<small style="font-size: 11px; color: #c7c7cc;">Attachments are required by default</small>
							</div>
							</div>
							<div style="display: flex; gap: 8px; margin-top: 8px; align-items: center;">
								<button type="button" class="btn btn-primary" id="addCampaignAttachmentBtn">
									<i class="fas fa-plus"></i> Add Attachment
								</button>
								<button type="button" class="btn btn-secondary" id="removeAllCampaignAttachmentsBtn">
									<i class="fas fa-trash"></i> Remove All
								</button>
								<div style="margin-left: auto; font-size: 12px; color: #8E8E93;">
									<i class="fas fa-info-circle"></i> 
									<span id="attachmentStatus">Required</span>
								</div>
							</div>
						</div>
						<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
							<div class="form-group">
								<label>Batch Size</label>
								<input type="number" id="batchSize" value="50" min="1" max="100">
                    </div>
							<div class="form-group">
								<label>Delay Between Emails (seconds)</label>
								<input type="number" id="emailDelay" value="5" min="1" max="60">
                        </div>
                    </div>
						<div style="display:flex; gap:8px; flex-wrap:wrap; margin-top: 10px;">
							<select id="templateSelect" style="min-width:180px;"></select>
							<button class="btn btn-secondary" id="loadTemplateBtn"><i class="fas fa-download"></i>Load</button>
							<button class="btn btn-secondary" id="saveTemplateBtn"><i class="fas fa-save"></i>Save</button>
							<button class="btn btn-danger" id="deleteTemplateBtn"><i class="fas fa-trash"></i>Delete</button>
                </div>
						<div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; align-items:center;">
							<label style="min-width:120px;">Preset templates</label>
							<select id="presetTemplateSelect" style="min-width:220px;"></select>
							<button class="btn btn-secondary" id="insertPresetBtn"><i class="fas fa-plus"></i>Insert</button>
						</div>
						<div style="display: flex; gap: 10px; margin-top: 12px; flex-wrap:wrap; align-items:flex-end;">
							<button class="btn btn-secondary" id="sendTestBtn">
								<i class="fas fa-paper-plane"></i>Send Test Email
                            </button>
							<button class="btn btn-primary" id="startCampaignBtn">
								<i class="fas fa-rocket"></i>Start Campaign
                            </button>
							<!-- Filters -->
							<div class="form-group" style="margin:0; min-width:120px;">
								<label style="font-size:12px;">From</label>
								<input type="number" id="filterFrom" placeholder="1">
							</div>
							<div class="form-group" style="margin:0; min-width:120px;">
								<label style="font-size:12px;">To</label>
								<input type="number" id="filterTo" placeholder="" >
                        </div>
							<div class="form-group" style="margin:0; min-width:140px;">
								<label style="font-size:12px;">Parity</label>
								<select id="filterParity">
									<option value="all">All</option>
									<option value="even">Even</option>
									<option value="odd">Odd</option>
								</select>
                                </div>
							<div class="form-group" style="margin:0; min-width:200px;">
								<label style="font-size:12px;">Placeholder key present</label>
								<input type="text" id="filterPlaceholderKey" placeholder="e.g. EMAIL or Name">
                            </div>
							<div class="form-group" style="margin:0; min-width:200px;">
								<label style="font-size:12px;">Status contains</label>
								<input type="text" id="filterStatusText" placeholder="e.g. red/error">
                        </div>
                    </div>
                </div>

					<!-- Scheduling -->
					<div style="margin-bottom: 16px; padding: 16px; background: #f2f2f7; border-radius: 8px;">
						<h3 style="margin-bottom: 10px;">Step 3: Schedule (Optional)</h3>
						<div style="display:grid; grid-template-columns: 1fr auto; gap: 12px; align-items:end;">
							<div class="form-group" style="margin:0;">
								<label>Send At</label>
								<input type="datetime-local" id="scheduleDateTime">
							</div>
							<button class="btn btn-secondary" id="scheduleBtn" onclick="window.rtxApp && window.rtxApp.scheduleOneTimeSend()"><i class="fas fa-clock"></i>Schedule</button>
                    </div>
						<div id="scheduleList" style="margin-top:12px;"></div>
                        </div>
                        
					<!-- Campaigns List -->
					<div>
						<h3 style="margin-bottom: 10px;">Campaign History</h3>
						<div id="campaignsList">
                            <div class="empty-state">
                                <i class="fas fa-envelope-open"></i>
                                <h3>No Campaigns Yet</h3>
                                <p>Create your first email campaign to get started</p>
                            </div>
                        </div>
                    </div>
                            </div>
                        </div>
                    </div>
                </div>

	<!-- Login Modal -->
	<div class="modal" id="loginModal">
		<div class="modal-content">
			<div class="modal-header">
				<h3>Login</h3>
				<button class="modal-close" onclick="document.getElementById('loginModal').style.display='none'">&times;</button>
						</div>
			<div class="modal-body">
				<div style="display:flex; flex-direction:column; gap:18px;">
					<div style="background:#f7f7fa; border:1px solid #e5e5e7; border-radius:8px; padding:12px;">
						<h4 style="margin-bottom:8px;">Option A: Gmail App Password (Recommended)</h4>
						<p style="font-size:13px; color:#666; margin-bottom:8px;">Enter your Gmail address and App Password. We never store your regular password. App Passwords can be revoked anytime in your Google Account.</p>
						<div class="form-group" style="margin-bottom:8px;">
							<label>Gmail Address</label>
							<input type="email" id="smtpEmail" placeholder="you@gmail.com">
						</div>
						<div class="form-group" style="margin-bottom:8px;">
							<label>Gmail App Password</label>
							<input type="password" id="smtpAppPassword" placeholder="16-character app password">
						</div>
						<div style="display:flex; gap:10px;">
							<button class="btn btn-primary" id="smtpLoginBtn"><i class="fas fa-right-to-bracket"></i>Login</button>
							<button class="btn btn-secondary" id="smtpFetchSignatureBtn"><i class="fas fa-signature"></i>Fetch Signature</button>
						</div>
					</div>

					<div style="background:#f7f7fa; border:1px solid #e5e5e7; border-radius:8px; padding:12px;">
						<h4 style="margin-bottom:8px;">Option B: Google OAuth (Legacy)</h4>
						<p style="font-size:13px; color:#666; margin-bottom:8px;">Upload your Google OAuth client credentials JSON. Not required for most users.</p>
						<div class="form-group" style="margin-bottom:8px;">
							<label>Upload Google API Credentials</label>
							<input type="file" id="credentialsFile" accept=".json">
						</div>
						<button class="btn btn-secondary" id="uploadCredentialsBtn">
							<i class="fas fa-upload"></i>Upload & Connect
						</button>
						<div class="muted" style="margin-top:8px;">Or use <strong>Sign in with Google</strong> from the main screen (recommended). Upload is optional for advanced users.</div>
                    </div>

					<div style="display:flex; gap: 10px; margin-top: 10px;">
						<button class="btn btn-secondary" onclick="document.getElementById('loginModal').style.display='none'">Close</button>
					</div>
				</div>
							</div>
					</div>
			</div>

	<!-- Loading Overlay -->
	<div class="loading-overlay" id="loadingOverlay" style="display: none;">
		<div class="loading-content">
			<i class="fas fa-spinner fa-spin" style="font-size: 32px; color: #007AFF; margin-bottom: 15px;"></i>
			<p id="loadingMessage">Loading...</p>
                    </div>
                        </div>

	<!-- Authentication Modal -->
	<div id="authModal" class="modal">
		<div class="modal-content">
			<div class="modal-header">
				<h3><i class="fas fa-shield-alt"></i> Google Authentication</h3>
				<button class="modal-close" onclick="document.getElementById('authModal').style.display='none'">&times;"></button>
			</div>
			<div class="modal-body">
				<div class="auth-options">
					<div class="auth-option">
						<h4><i class="fab fa-google"></i> Sign in with Google</h4>
						<p>Use your Google account to access Gmail and Google Sheets</p>
						<button id="modalGoogleLoginBtn" class="btn btn-primary">
							<i class="fab fa-google"></i> Continue with Google
						</button>
					</div>
					<div class="auth-divider">
						<span>or</span>
					</div>
					<div class="auth-option">
						<h4><i class="fab fa-key"></i> Upload Credentials</h4>
						<p>Upload your Google API credentials JSON file</p>
						<div class="credentials-upload">
							<input type="file" id="modalCredentialsFile" accept=".json" style="display: none;">
							<button id="modalUploadCredentialsBtn" class="btn btn-secondary">
								<i class="fas fa-upload"></i> Choose File
							</button>
							<div id="selectedFileName" style="margin-top: 8px; font-size: 12px; color: #666;"></div>
						</div>
					</div>
				</div>
			</div>
                    </div>
                        </div>
                        
	<div class="modal" id="logsModal" style="display:none;">
		<div class="modal-content" style="max-width: 900px; width: 90%;">
			<div class="modal-header">
				<h3>Session Logs</h3>
				<button class="modal-close" onclick="document.getElementById('logsModal').style.display='none'">&times;</button>
                            </div>
			<div class="modal-body">
				<pre id="logsContent" style="white-space:pre-wrap; max-height:70vh; overflow:auto; background:#0b0b0f; color:#d7d7db; padding:16px; border-radius:8px; font-size:12px;"></pre>
                        </div>
                    </div>
                </div>

	<!-- Signature Builder Modal -->
	<div class="modal" id="signatureBuilderModal" style="display:none;">
		<div class="modal-content" style="max-width: 900px; width: 90%;">
			<div class="modal-header">
				<h3>Signature Builder</h3>
				<button class="modal-close" onclick="document.getElementById('signatureBuilderModal').style.display='none'">&times;</button>
			</div>
			<div class="modal-body">
				<div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px;">
					<!-- Editor Panel -->
					<div>
						<h4>Signature Editor</h4>
						<div class="form-group">
							<label>Signature Name</label>
							<input type="text" id="sigName" placeholder="e.g. Default, Business, Personal">
						</div>
						<div class="form-group">
							<label>HTML Content</label>
							<div id="signatureEditorToolbar" style="border:1px solid #ddd; border-bottom:none; padding:8px; background:#f8f9fa;">
								<button type="button" onclick="execCommand('bold')" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;"><strong>B</strong></button>
								<button type="button" onclick="execCommand('italic')" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;"><em>I</em></button>
								<button type="button" onclick="execCommand('underline')" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;"><u>U</u></button>
								<button type="button" onclick="execCommand('insertUnorderedList')" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;">•</button>
								<button type="button" onclick="execCommand('insertOrderedList')" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;">1.</button>
								<button type="button" onclick="execCommand('createLink')" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;">🔗</button>
								<button type="button" onclick="insertImage().catch(console.error)" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;">🖼️</button>
								<button type="button" onclick="clearFormatting()" style="padding:4px 8px; margin:2px; border:1px solid #ccc; background:#fff; cursor:pointer;">🧹</button>
							</div>
							<div id="signatureEditor" contenteditable="true" style="height:200px; border:1px solid #ddd; padding:12px; overflow-y:auto; background:#fff;" placeholder="Enter your signature content..."></div>
						</div>
						<div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:12px;">
							<button class="btn btn-primary" onclick="saveSignature()"><i class="fas fa-save"></i>Save Signature</button>
							<button class="btn btn-secondary" onclick="loadSignature()"><i class="fas fa-download"></i>Load</button>
							<button class="btn btn-danger" onclick="deleteSignature()"><i class="fas fa-trash"></i>Delete</button>
							<button class="btn btn-secondary" onclick="applySignatureToEmail()"><i class="fas fa-check"></i>Use in Emails</button>
						</div>
					</div>
					
					<!-- Preview Panel -->
					<div>
						<h4>Preview & Management</h4>
						<div class="form-group">
							<label>Signature Preview</label>
							<div id="signaturePreview" style="min-height:200px; border:1px solid #ddd; padding:12px; background:#fff; overflow-y:auto;"></div>
						</div>
						<div class="form-group">
							<label>Saved Signatures</label>
							<select id="signatureSelect" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
								<option value="">Select a signature to load...</option>
							</select>
						</div>
						<div style="background:#f8f9fa; padding:12px; border-radius:4px; font-size:12px;">
							<strong>Tips:</strong>
							<ul style="margin:8px 0; padding-left:20px;">
								<li>Use HTML for rich formatting (bold, italic, links)</li>
								<li>Images should use absolute URLs (https://...)</li>
								<li>Keep signatures concise for better email delivery</li>
								<li>Test your signature before using in campaigns</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Signature Modal -->
	<div class="modal" id="signatureModal" style="display:none;">
		<div class="modal-content" style="max-width: 900px; width: 90%;">
            <div class="modal-header">
				<h3>Signature Builder</h3>
				<button class="modal-close" onclick="document.getElementById('signatureModal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
				<div class="form-group">
					<label>Signature Name</label>
					<input type="text" id="sigName" placeholder="e.g. Default">
				</div>
				<div class="form-group">
					<label>Signature HTML</label>
					<textarea id="sigHtml" rows="10" placeholder="Paste or edit HTML (images with absolute URLs)"></textarea>
                    </div>
				<div style="display:flex; gap:8px; flex-wrap:wrap;">
					<button class="btn btn-primary" id="saveSignatureBtn"><i class="fas fa-save"></i>Save</button>
					<button class="btn btn-secondary" id="loadSignatureBtn"><i class="fas fa-download"></i>Load</button>
					<button class="btn btn-danger" id="deleteSignatureBtn"><i class="fas fa-trash"></i>Delete</button>
					<button class="btn btn-secondary" id="applySignatureBtn" onclick="applySignatureToEmail()"><i class="fas fa-check"></i>Use in emails</button>
                    </div>
				<div style="margin-top:12px; border:1px solid #e5e5e7; border-radius:8px; padding:10px;">
					<div id="sigPreview" style="min-height:80px;">Signature Preview</div>
                </div>
				<small class="muted">Tip: Host images (logo/icons) and use full URLs (https://…). Inline base64 images also work.</small>
            </div>
        </div>
    </div>

	<div class="modal" id="emailPreviewModal" style="display:none;">
		<div class="modal-content" style="max-width: 900px; width: 90%;">
			<div class="modal-header">
				<h3>Email Preview</h3>
				<button class="modal-close" onclick="document.getElementById('emailPreviewModal').style.display='none'">&times;</button>
			</div>
			<div class="modal-body" id="emailPreviewBody" style="max-height:70vh; overflow:auto;"></div>
        </div>
    </div>

	<!-- About Modal -->
	<div class="modal" id="aboutModal" style="display:none;">
		<div class="modal-content" style="max-width: 600px; width: 90%;">
			<div class="modal-header">
				<h3>About TASK FORCE</h3>
				<button class="modal-close" onclick="document.getElementById('aboutModal').style.display='none'">&times;</button>
			</div>
			<div class="modal-body">
				<p><strong>Version:</strong> <span id="aboutVersion">-</span></p>
				<p>Mass mailer with Google Sheets integration by RTX Innovations.</p>
			</div>
		</div>
	</div>

	<!-- Welcome Modal -->
	<div class="modal" id="welcomeModal" style="display:none;">
		<div class="modal-content" style="max-width: 700px; width: 90%;">
			<div class="modal-header">
				<h3>Welcome to TASK FORCE</h3>
				<button class="modal-close" onclick="document.getElementById('welcomeModal').style.display='none'">&times;</button>
			</div>
			<div class="modal-body">
				<p>Thanks for installing TASK FORCE. Use the steps to connect Google Sheets and send personalized emails in bulk.</p>
				<ol>
					<li>Login using Gmail App Password or OAuth</li>
					<li>Paste your Google Sheets URL</li>
					<li>Compose your email using placeholders like ((Name))</li>
					<li>Send a test, then start the campaign</li>
				</ol>
			</div>
		</div>
	</div>

	<!-- Release Notes Modal -->
	<div class="modal" id="releaseNotesModal" style="display:none;">
		<div class="modal-content" style="max-width: 700px; width: 90%;">
			<div class="modal-header">
				<h3>Release Notes</h3>
				<button class="modal-close" onclick="document.getElementById('releaseNotesModal').style.display='none'">&times;</button>
			</div>
			<div class="modal-body" id="releaseNotesBody"></div>
		</div>
	</div>

	<!-- Privacy Modal -->
	<div class="modal" id="privacyModal" style="display:none;">
		<div class="modal-content" style="max-width: 800px; width: 90%;">
			<div class="modal-header"><h3>Privacy Policy</h3><button class="modal-close" onclick="document.getElementById('privacyModal').style.display='none'">&times;</button></div>
			<div class="modal-body" style="max-height:70vh; overflow:auto;">
				<p>We do not collect or transmit your personal data. OAuth tokens and SMTP App Passwords are stored locally on your device using secure storage. Emails are sent directly from your account to recipients. Logs remain on your device unless you share them.</p>
				<p>When using the web app, content is processed in your browser. If you opt into a relay for SMTP, credentials are used only for that request and not stored.</p>
			</div>
		</div>
	</div>

	<!-- Terms Modal -->
	<div class="modal" id="termsModal" style="display:none;">
		<div class="modal-content" style="max-width: 800px; width: 90%;">
			<div class="modal-header"><h3>Terms of Service</h3><button class="modal-close" onclick="document.getElementById('termsModal').style.display='none'">&times;</button></div>
			<div class="modal-body" style="max-height:70vh; overflow:auto;">
				<p>By using TASK FORCE, you agree to send emails only to recipients who have consented to receive them and to comply with Gmail and local anti-spam laws. You are responsible for your account and content. This software is provided "as-is" without warranties.</p>
			</div>
		</div>
	</div>



	<!-- Email Sending Progress Modal -->
	<div id="emailProgressModal" class="modal">
		<div class="modal-content" style="max-width: 500px;">
			<div class="modal-header">
				<h3><i class="fas fa-paper-plane"></i> Sending Emails</h3>
			</div>
			<div class="modal-body">
				<div id="emailProgressStatus" style="text-align: center; margin-bottom: 20px;">
					<p>Preparing to send emails...</p>
				</div>
				
				<div style="margin-bottom: 20px;">
					<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
						<span>Progress</span>
						<span id="emailProgressText">0/0</span>
					</div>
					<div style="width: 100%; height: 12px; background: #e5e5e7; border-radius: 6px; overflow: hidden;">
						<div id="emailProgressBar" style="height: 100%; background: #34C759; width: 0%; transition: width 0.3s;"></div>
					</div>
				</div>
				
				<div id="emailProgressDetails" style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 20px; max-height: 200px; overflow-y: auto;">
					<div style="font-size: 12px; color: #8E8E93;">Waiting for emails to start...</div>
				</div>
				
				<div style="display: flex; gap: 8px; justify-content: center;">
					<button class="btn btn-danger" id="cancelEmailSendingBtn">
						<i class="fas fa-times"></i> Cancel Sending
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Attachment Modal -->
	<div id="attachmentModal" class="modal">
		<div class="modal-content" style="max-width: 600px;">
			<div class="modal-header">
				<h3><i class="fas fa-paperclip"></i> Email Attachments</h3>
				<button class="btn btn-secondary" id="closeAttachmentModal">&times;</button>
			</div>
			<div class="modal-body">
				<div class="form-group" style="margin-bottom: 16px;">
					<label>Attachments</label>
					<div id="attachmentList" style="border: 1px solid #e5e5e7; border-radius: 6px; padding: 12px; min-height: 100px; background: #f8f9fa;">
						<div style="text-align: center; color: #8E8E93;">
							<i class="fas fa-paperclip" style="font-size: 24px; margin-bottom: 8px; display: block;"></i>
							<p>No attachments selected</p>
						</div>
					</div>
				</div>
				
				<div style="display: flex; gap: 8px; margin-bottom: 16px;">
					<button class="btn btn-secondary" id="addAttachmentBtn">
						<i class="fas fa-plus"></i> Add Attachment
					</button>
					<button class="btn btn-secondary" id="removeAllAttachmentsBtn">
						<i class="fas fa-trash"></i> Remove All
					</button>
				</div>
				
				<div style="display: flex; gap: 8px; justify-content: center;">
					<button class="btn btn-secondary" id="continueWithoutAttachmentsBtn">
						<i class="fas fa-paper-plane"></i> Continue Without Attachments
					</button>
					<button class="btn btn-primary" id="confirmAttachmentsBtn">
						<i class="fas fa-check"></i> Confirm Attachments
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Subject Line Placeholders Modal -->
	<div id="subjectPlaceholdersModal" class="modal">
		<div class="modal-content" style="max-width: 500px;">
			<div class="modal-header">
				<h3><i class="fas fa-tags"></i> Subject Line Placeholders</h3>
				<button class="btn btn-secondary" id="closeSubjectPlaceholdersModal">&times;</button>
			</div>
			<div class="modal-body">
				<div class="form-group" style="margin-bottom: 16px;">
					<label>Available Placeholders</label>
					<div id="subjectPlaceholdersList" style="border: 1px solid #e5e5e7; border-radius: 6px; padding: 12px; max-height: 300px; overflow-y: auto;">
						<!-- Placeholders will be populated here -->
					</div>
				</div>
				
				<div class="form-group" style="margin-bottom: 16px;">
					<label>Subject Line Preview</label>
					<input type="text" id="subjectPreviewInput" placeholder="Subject line with placeholders..." style="width: 100%;">
				</div>
				
				<div style="display: flex; gap: 8px; justify-content: center;">
					<button class="btn btn-primary" id="insertSubjectPlaceholderBtn">
						<i class="fas fa-plus"></i> Insert Selected
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Signature Management -->
	<div style="margin-bottom: 16px; padding: 16px; background: #f2f2f7; border-radius: 8px;">
		<h3 style="margin-bottom: 10px;"><i class="fas fa-signature"></i> Email Signature</h3>
		<div class="form-group" style="margin-bottom:10px;">
			<label>Signature Name</label>
			<input type="text" id="signatureName" placeholder="Enter signature name">
		</div>
		<div class="form-group" style="margin-bottom:10px;">
			<label>Signature Content</label>
			<div id="signatureEditor" contenteditable="true" style="height:200px; border:1px solid #ddd; padding:12px; overflow-y:auto; background:#fff; border-radius:6px;" placeholder="Enter your signature content..."></div>
		</div>
		<div style="display:flex; gap:8px; flex-wrap:wrap;">
			<button class="btn btn-primary" id="saveSignatureBtn" onclick="saveSignature().catch(console.error)">
				<i class="fas fa-save"></i>Save Signature
			</button>
			<button class="btn btn-secondary" id="loadSignatureBtn" onclick="loadSignature().catch(console.error)">
				<i class="fas fa-folder-open"></i>Load Signature
			</button>
			<button class="btn btn-secondary" id="clearSignatureBtn" onclick="clearSignature()">
				<i class="fas fa-eraser"></i>Clear
			</button>
		</div>
		<div id="signaturesList" style="margin-top:12px; display:none;">
			<h4 style="margin-bottom:8px;">Saved Signatures</h4>
			<div id="signaturesContainer"></div>
		</div>
	</div>

	<script>
		// Theme toggle behavior
		document.getElementById('themeToggle')?.addEventListener('click', () => {
			const body = document.body; const isDark = body.classList.contains('theme-dark');
			if (isDark) { body.classList.remove('theme-dark'); body.classList.add('theme-light'); }
			else { body.classList.remove('theme-light'); body.classList.add('theme-dark'); }
		});
		// Import spreadsheet button
		document.getElementById('importSheetBtn')?.addEventListener('click', async () => {
			const res = await window.electronAPI.showOpenDialog({ properties: ['openFile'], filters: [{ name: 'Spreadsheets', extensions: ['csv','xlsx','xls'] }] });
			if (!res.canceled && res.filePaths?.length) {
				const out = await window.electronAPI.loadLocalSpreadsheet(res.filePaths[0]);
				if (out.success) {
					window.rtxApp.onSheetsConnected(out.data);
					document.getElementById('sheetUrlInput').value = res.filePaths[0];
				} else {
					window.rtxApp.showError('Failed to import: ' + out.error);
				}
			}
		});
		// Logs button
		document.getElementById('logsBtn')?.addEventListener('click', async () => {
			const out = await window.electronAPI.readSessionLog();
			if (out.success) {
				document.getElementById('logsContent').textContent = out.content || '';
				document.getElementById('logsModal').style.display = 'block';
			} else {
				window.rtxApp.showError('Failed to read logs: ' + out.error);
			}
		});
		window.electronAPI.onAppLog?.((d) => {
			const el = document.getElementById('logsContent');
			if (el && document.getElementById('logsModal').style.display === 'block') {
				el.textContent += `\n${new Date(d.ts).toLocaleTimeString()} [${d.level}] ${d.message}`;
			}
		});
		// Data preview UI interactions
		const drawer = document.getElementById('dataPreviewDrawer');
		document.getElementById('togglePreviewBtn')?.addEventListener('click', () => {
			drawer.style.display = drawer.style.display === 'none' ? 'block' : 'none';
		});
		document.getElementById('closePreviewBtn')?.addEventListener('click', () => { drawer.style.display = 'none'; });
		document.getElementById('previewFullscreenBtn')?.addEventListener('click', () => {
			drawer.requestFullscreen?.();
		});
		document.getElementById('previewPosition')?.addEventListener('change', (e) => {
			const pos = e.target.value;
			const container = document.querySelector('.mailer-interface');
			if (!container) return;
			if (pos === 'top') container.insertBefore(drawer, container.children[2]);
			if (pos === 'bottom') container.appendChild(drawer);
			if (pos === 'left') drawer.style.float = 'left';
			if (pos === 'right') drawer.style.float = 'right';
		});
		// Click to insert placeholder
		document.addEventListener('click', (ev) => {
			const target = ev.target;
			if (target?.dataset?.placeholderKey) {
				const key = target.dataset.placeholderKey;
				const ta = document.getElementById('emailContent');
				if (ta) {
					const ins = `((${key}))`;
					const start = ta.selectionStart || ta.value.length;
					ta.value = ta.value.slice(0, start) + ins + ta.value.slice(start);
					window.rtxApp.showSuccess(`Inserted placeholder: ((${key}))`);
				}
			}
		});
		// Search columns
		document.getElementById('placeholderSearch')?.addEventListener('input', (e) => {
			const q = (e.target.value || '').toLowerCase();
			const chips = document.querySelectorAll('[data-placeholder-key]');
			chips.forEach(c => { c.style.display = c.dataset.placeholderKey.toLowerCase().includes(q) ? 'inline-flex' : 'none'; });
		});
		// Assistant search filters below content
		document.getElementById('assistantSearch')?.addEventListener('input', (e) => {
			const q = (e.target.value || '').toLowerCase();
			document.querySelectorAll('#assistantChips [data-placeholder-key]')?.forEach(c => { c.style.display = c.dataset.placeholderKey.toLowerCase().includes(q) ? 'inline-flex' : 'none'; });
		});

		// Help dropdown listeners
		(function(){
			const helpBtn = document.getElementById('helpToolbarBtn');
			const helpMenu = document.getElementById('helpDropdown');
			const closeAll = (ev) => {
				if (!helpMenu) return;
				if (ev && (helpMenu.contains(ev.target) || helpBtn.contains(ev.target))) return;
				helpMenu.style.display = 'none';
			};
			helpBtn?.addEventListener('click', (e) => {
				e.stopPropagation();
				if (!helpMenu) return;
				helpMenu.style.display = helpMenu.style.display === 'none' ? 'block' : 'none';
			});
			document.addEventListener('click', closeAll);
			document.getElementById('helpCheckBtn')?.addEventListener('click', () => { try { window.electronAPI?.checkForUpdates?.(); } catch(_){} closeAll({}); });
			document.getElementById('helpAboutBtn')?.addEventListener('click', () => { try { window.rtxApp?.openAboutModal?.(); } catch(_){} closeAll({}); });
			document.getElementById('helpWelcomeBtn')?.addEventListener('click', () => { try { window.rtxApp?.openWelcomeModal?.(); } catch(_){} closeAll({}); });
			document.getElementById('helpReleaseNotesBtn')?.addEventListener('click', () => { try { window.rtxApp?.openReleaseNotesModal?.(); } catch(_){} closeAll({}); });
		})();

		// Signature Builder actions
		document.getElementById('saveSignatureBtn')?.addEventListener('click', async () => {
			const name = document.getElementById('sigName').value?.trim();
			const html = document.getElementById('sigHtml').value || '';
			if (!name) { window.rtxApp.showError('Please enter signature name'); return; }
			const list = (await window.electronAPI.storeGet('signatures')) || [];
			const filtered = Array.isArray(list) ? list.filter(s => s.name !== name) : [];
			filtered.unshift({ name, html, ts: Date.now() });
			await window.electronAPI.storeSet('signatures', filtered);
			document.getElementById('sigPreview').innerHTML = html;
			window.rtxApp.showSuccess('Signature saved');
		});
		document.getElementById('loadSignatureBtn')?.addEventListener('click', async () => {
			const list = (await window.electronAPI.storeGet('signatures')) || [];
			if (!Array.isArray(list) || !list.length) { window.rtxApp.showError('No saved signatures'); return; }
			const pick = list[0];
			document.getElementById('sigName').value = pick.name || '';
			document.getElementById('sigHtml').value = pick.html || '';
			document.getElementById('sigPreview').innerHTML = pick.html || '';
		});
		document.getElementById('deleteSignatureBtn')?.addEventListener('click', async () => {
			const name = document.getElementById('sigName').value?.trim();
			const list = (await window.electronAPI.storeGet('signatures')) || [];
			const filtered = Array.isArray(list) ? list.filter(s => s.name !== name) : [];
			await window.electronAPI.storeSet('signatures', filtered);
			window.rtxApp.showSuccess('Signature deleted');
		});

		// Update banner wiring
		(function(){
			try {
				const banner = document.getElementById('updateBanner');
				const text = document.getElementById('updateBannerText');
				const action = document.getElementById('updateActionBtn');
				let lastInfo = null;
				if (window.electronAPI?.onUpdateStatus) {
					window.electronAPI.onUpdateStatus((data) => {
						if (!data) return;
						if (data.status === 'available') {
							lastInfo = data.info || null;
							if (text) text.textContent = `New version ${data.info?.version} is available`;
							if (banner) banner.style.display = 'block';
							if (action) {
								action.textContent = 'Download';
								action.onclick = () => window.electronAPI?.downloadUpdate?.();
							}
						} else if (data.status === 'downloading') {
							if (text) text.textContent = `Downloading update... ${Math.round(data.progress?.percent || 0)}%`;
							if (banner) banner.style.display = 'block';
							if (action) { action.textContent = 'Please wait'; action.disabled = true; }
						} else if (data.status === 'downloaded') {
							if (text) text.textContent = 'Update downloaded. Click install to restart.';
							if (banner) banner.style.display = 'block';
							if (action) { action.disabled = false; action.textContent = 'Install'; action.onclick = () => window.electronAPI?.quitAndInstall?.(); }
						} else if (data.status === 'none') {
							if (banner) banner.style.display = 'none';
						} else if (data.status === 'error') {
							if (text) text.textContent = 'Update check failed';
							if (banner) banner.style.display = 'block';
							if (action) { action.textContent = 'Retry'; action.disabled = false; action.onclick = () => window.electronAPI?.checkForUpdates?.(); }
						}
					});
				}
				// On first load, perform a check; older v1.4.0 will show available → static banner
				setTimeout(() => { try { window.electronAPI?.checkForUpdates?.(); } catch (_) {} }, 3000);
			} catch (_) {}
		})();
	</script>

	<script>
		// Enhanced ContentEditable Editor Functions
		let wordCountInterval = null;
		
		// Initialize the enhanced editor
		function initEnhancedEditor() {
			const editor = document.getElementById('emailEditor');
			if (!editor) return;

			// Add placeholder functionality
			editor.addEventListener('focus', function() {
				if (editor.textContent === '') {
					editor.textContent = '';
				}
			});

			editor.addEventListener('blur', function() {
				if (editor.textContent.trim() === '') {
					editor.textContent = '';
				}
			});

			// Add keyboard shortcuts
			editor.addEventListener('keydown', function(e) {
				// Ctrl+B for bold
				if (e.ctrlKey && e.key === 'b') {
					e.preventDefault();
					formatText('bold');
				}
				// Ctrl+I for italic
				if (e.ctrlKey && e.key === 'i') {
					e.preventDefault();
					formatText('italic');
				}
				// Ctrl+U for underline
				if (e.ctrlKey && e.key === 'u') {
					e.preventDefault();
					formatText('underline');
				}
				// Ctrl+K for link
				if (e.ctrlKey && e.key === 'k') {
					e.preventDefault();
					insertLink();
				}
			});

			// Update toolbar state based on selection
			editor.addEventListener('mouseup', updateToolbarState);
			editor.addEventListener('keyup', updateToolbarState);

			// Add font family and size change handlers
			const fontFamilySelect = document.getElementById('fontFamily');
			const fontSizeSelect = document.getElementById('fontSize');
			
			if (fontFamilySelect) {
				fontFamilySelect.addEventListener('change', function() {
					execCommand('fontName', this.value);
				});
			}
			
			if (fontSizeSelect) {
				fontSizeSelect.addEventListener('change', function() {
					execCommand('fontSize', this.value);
				});
			}
		}

		function startWordCount() {
			const editor = document.getElementById('emailEditor');
			if (!editor) return;

			wordCountInterval = setInterval(() => {
				const text = editor.textContent || '';
				const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
				const chars = text.length;

				document.getElementById('wordCount').textContent = `${words} words`;
				document.getElementById('charCount').textContent = `${chars} chars`;
			}, 500);
		}

		function updateToolbarState() {
			const editor = document.getElementById('emailEditor');
			if (!editor) return;

			// Update button states based on current selection
			const selection = window.getSelection();
			if (selection.rangeCount > 0) {
				const range = selection.getRangeAt(0);
				const parentElement = range.commonAncestorContainer.nodeType === Node.TEXT_NODE ? 
					range.commonAncestorContainer.parentElement : range.commonAncestorContainer;
				
				// Check if parent is a formatting element
				document.getElementById('boldBtn').classList.toggle('active', parentElement.tagName === 'B' || parentElement.tagName === 'STRONG');
				document.getElementById('italicBtn').classList.toggle('active', parentElement.tagName === 'I' || parentElement.tagName === 'EM');
				document.getElementById('underlineBtn').classList.toggle('active', parentElement.style.textDecoration === 'underline');
				document.getElementById('strikeBtn').classList.toggle('active', parentElement.tagName === 'S' || parentElement.tagName === 'STRIKE');
			}
		}

		// Modern text formatting functions
		function formatText(command) {
			const editor = document.getElementById('emailEditor');
			if (!editor) return;

			const selection = window.getSelection();
			if (selection.rangeCount === 0) return;

			const range = selection.getRangeAt(0);
			const selectedText = range.toString();
			
			if (selectedText.length === 0) return;

			let element;
			switch (command) {
				case 'bold':
					element = document.createElement('strong');
					break;
				case 'italic':
					element = document.createElement('em');
					break;
				case 'underline':
					element = document.createElement('span');
					element.style.textDecoration = 'underline';
					break;
				case 'strikeThrough':
					element = document.createElement('s');
					break;
				default:
					return;
			}

			element.textContent = selectedText;
			range.deleteContents();
			range.insertNode(element);
			
			// Update toolbar state
			updateToolbarState();
		}

		// Modern command execution with fallback
		function execCommand(command, value = null) {
			// Try modern approach first
			if (command === 'bold') {
				formatText('bold');
				return;
			}
			if (command === 'italic') {
				formatText('italic');
				return;
			}
			if (command === 'underline') {
				formatText('underline');
				return;
			}
			if (command === 'strikeThrough') {
				formatText('strikeThrough');
				return;
			}
			
			// Fallback to execCommand for other commands
			if (document.execCommand) {
				document.execCommand(command, false, value);
			}
			updateToolbarState();
		}

		async function insertLink() {
			const url = await window.rtxApp.showInputDialog('Insert Link', 'Enter URL:', 'https://');
			if (url) {
				const editor = document.getElementById('emailEditor');
				const selection = window.getSelection();
				
				if (selection.rangeCount > 0) {
					const range = selection.getRangeAt(0);
					const selectedText = range.toString();
					
					if (selectedText.length === 0) {
						// Insert link with placeholder text
						const linkElement = document.createElement('a');
						linkElement.href = url;
						linkElement.textContent = url;
						linkElement.target = '_blank';
						range.insertNode(linkElement);
					} else {
						// Wrap selected text in link
						const linkElement = document.createElement('a');
						linkElement.href = url;
						linkElement.target = '_blank';
						linkElement.textContent = selectedText;
						range.deleteContents();
						range.insertNode(linkElement);
					}
				}
			}
		}

		async function insertImage() {
			const url = await window.rtxApp.showInputDialog('Insert Image', 'Enter image URL:', 'https://');
			if (url) {
				const editor = document.getElementById('emailEditor');
				const selection = window.getSelection();
				
				if (selection.rangeCount > 0) {
					const range = selection.getRangeAt(0);
					const imgElement = document.createElement('img');
					imgElement.src = url;
					imgElement.alt = 'Inserted image';
					imgElement.style.maxWidth = '100%';
					imgElement.style.height = 'auto';
					
					range.insertNode(imgElement);
				}
			}
		}

		async function insertTable() {
			const rows = await window.rtxApp.showInputDialog('Insert Table', 'Enter number of rows:', '3');
			const cols = await window.rtxApp.showInputDialog('Insert Table', 'Enter number of columns:', '3');
			
			if (rows && cols) {
				const editor = document.getElementById('emailEditor');
				const selection = window.getSelection();
				
				if (selection.rangeCount > 0) {
					const range = selection.getRangeAt(0);
					
					let tableHTML = '<table border="1" style="border-collapse: collapse; width: 100%; margin: 10px 0;">';
					for (let i = 0; i < parseInt(rows); i++) {
						tableHTML += '<tr>';
						for (let j = 0; j < parseInt(cols); j++) {
							tableHTML += '<td style="padding: 8px; border: 1px solid #ddd;">Cell ' + (i + 1) + ',' + (j + 1) + '</td>';
						}
						tableHTML += '</tr>';
					}
					tableHTML += '</table>';
					
					// Create a temporary div to parse HTML
					const tempDiv = document.createElement('div');
					tempDiv.innerHTML = tableHTML;
					const tableElement = tempDiv.firstElementChild;
					
					range.insertNode(tableElement);
				}
			}
		}

		function clearFormatting() {
			const editor = document.getElementById('emailEditor');
			if (!editor) return;

			const selection = window.getSelection();
			if (selection.rangeCount === 0) return;

			const range = selection.getRangeAt(0);
			const selectedText = range.toString();
			
			if (selectedText.length === 0) return;

			// Remove formatting by creating a new text node
			const textNode = document.createTextNode(selectedText);
			range.deleteContents();
			range.insertNode(textNode);
			
			updateToolbarState();
		}

		function toggleEditorMode() {
			const editor = document.getElementById('emailEditor');
			const modeSpan = document.getElementById('editorMode');
			
			if (editor.contentEditable === 'true') {
				editor.contentEditable = 'false';
				modeSpan.textContent = 'Read Only Mode';
				editor.style.backgroundColor = '#f8f9fa';
			} else {
				editor.contentEditable = 'true';
				modeSpan.textContent = 'Standard Mode';
				editor.style.backgroundColor = '#fff';
			}
		}

		// Initialize editor when page loads
		document.addEventListener('DOMContentLoaded', function() {
			initEnhancedEditor();
			startWordCount();
			
			// Setup local spreadsheet import
			setupLocalSpreadsheetImport();
			
			// Setup signature management
			setupSignatureManagement();
		});
		
		// Local spreadsheet import functionality
		function setupLocalSpreadsheetImport() {
			const importBtn = document.getElementById('importLocalSheetBtn');
			if (!importBtn) return;
			
			importBtn.addEventListener('click', async () => {
				try {
					if (!window.electronAPI || !window.electronAPI.showOpenDialog) {
						alert('Local file import is only available in the desktop app');
						return;
					}
					
					const result = await window.electronAPI.showOpenDialog({
						properties: ['openFile'],
						filters: [
							{ name: 'Spreadsheet Files', extensions: ['csv', 'xlsx', 'xls'] },
							{ name: 'CSV Files', extensions: ['csv'] },
							{ name: 'Excel Files', extensions: ['xlsx', 'xls'] },
							{ name: 'All Files', extensions: ['*'] }
						],
						title: 'Select Spreadsheet File to Import'
					});
					
					if (!result.canceled && result.filePaths.length > 0) {
						const filePath = result.filePaths[0];
						await importLocalSpreadsheet(filePath);
					}
				} catch (error) {
					console.error('Error setting up local import:', error);
					alert('Error setting up local import: ' + error.message);
				}
			});
		}
		
		async function importLocalSpreadsheet(filePath) {
			try {
				if (!window.electronAPI || !window.electronAPI.loadLocalSpreadsheet) {
					alert('Local spreadsheet loading not available');
					return;
				}
				
				// Show loading state
				const importBtn = document.getElementById('importLocalSheetBtn');
				const originalText = importBtn.innerHTML;
				importBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>Importing...';
				importBtn.disabled = true;
				
				const result = await window.electronAPI.loadLocalSpreadsheet(filePath);
				
				if (result.success) {
					// Process the imported data
					processImportedData(result.data);
					
					// Update UI to show imported data
					document.getElementById('sheetsData').style.display = 'block';
					document.getElementById('sheetsData').innerHTML = `
						<div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 6px; padding: 12px; margin-bottom: 16px;">
							<strong>✅ Local file imported successfully!</strong><br>
							File: ${filePath.split('\\').pop().split('/').pop()}<br>
							Rows: ${result.data.rows.length}<br>
							Columns: ${result.data.headers.length}
						</div>
					`;
					
					// Enable refresh button
					document.getElementById('refreshSheetsBtn').disabled = false;
					
					// Show success message
					if (window.rtxApp && window.rtxApp.showSuccess) {
						window.rtxApp.showSuccess(`Successfully imported ${result.data.rows.length} rows from local file`);
					}
				} else {
					throw new Error(result.error || 'Failed to import file');
				}
			} catch (error) {
				console.error('Import error:', error);
				alert('Failed to import file: ' + error.message);
			} finally {
				// Restore button state
				const importBtn = document.getElementById('importLocalSheetBtn');
				importBtn.innerHTML = '<i class="fas fa-file-import"></i>Import Local File';
				importBtn.disabled = false;
			}
		}
		
		function processImportedData(data) {
			// Store the imported data globally for use in the app
			window.importedSheetData = data;
			
			// Update placeholder chips
			if (window.rtxApp && window.rtxApp.updatePlaceholderChips) {
				window.rtxApp.updatePlaceholderChips(data.headers);
			}
			
			// Update preview if available
			if (window.rtxApp && window.rtxApp.updateDataPreview) {
				window.rtxApp.updateDataPreview(data);
			}
		}

		// Enhanced Placeholder System with @ dropdown
		(function() {
			const editor = document.getElementById('emailEditor');
			const dropdown = document.getElementById('placeholderDropdown');
			const placeholderList = document.getElementById('placeholderList');
			let currentPlaceholders = [];
			
			if (editor && dropdown) {
				editor.addEventListener('input', function(e) {
					const text = editor.textContent || '';
					const cursorPosition = getCaretPosition(editor);
					const beforeCursor = text.substring(0, cursorPosition);
					
					// Check if user typed @
					if (beforeCursor.endsWith('@')) {
						showPlaceholderDropdown();
					} else if (beforeCursor.includes('@') && !beforeCursor.endsWith('@')) {
						// User typed something after @, hide dropdown
						hidePlaceholderDropdown();
					}
				});
				
				// Hide dropdown when clicking outside
				document.addEventListener('click', function(e) {
					if (!editor.contains(e.target) && !dropdown.contains(e.target)) {
						hidePlaceholderDropdown();
					}
				});
			}
			
			function showPlaceholderDropdown() {
				if (currentPlaceholders.length === 0) {
					// Populate with sample placeholders (in real app, these come from Google Sheets)
					currentPlaceholders = ['Name', 'Email', 'Company', 'Position', 'Phone', 'Address', 'City', 'State', 'Country'];
				}
				
				placeholderList.innerHTML = currentPlaceholders.map(placeholder => 
					`<div class="placeholder-item" onclick="insertPlaceholder('${placeholder}')" style="padding:8px 12px; cursor:pointer; border-bottom:1px solid #f0f0f0; transition:background 0.2s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='white'">
						<i class="fas fa-tag" style="color:#007AFF; margin-right:8px;"></i>
						${placeholder}
					</div>`
				).join('');
				
				// Position dropdown near cursor
				const selection = window.getSelection();
				if (selection.rangeCount > 0) {
					const range = selection.getRangeAt(0);
					const rect = range.getBoundingClientRect();
					dropdown.style.left = rect.left + 'px';
					dropdown.style.top = (rect.bottom + 5) + 'px';
				}
				
				dropdown.style.display = 'block';
			}
			
			function hidePlaceholderDropdown() {
				dropdown.style.display = 'none';
			}
			
			window.insertPlaceholder = function(placeholder) {
				const selection = window.getSelection();
				if (selection.rangeCount > 0) {
					const range = selection.getRangeAt(0);
					// Remove the @ symbol
					const text = editor.textContent || '';
					const cursorPos = getCaretPosition(editor);
					const beforeAt = text.substring(0, cursorPos - 1);
					const afterAt = text.substring(cursorPos);
					
					editor.textContent = beforeAt + `((${placeholder}))` + afterAt;
					
					// Set cursor after placeholder
					const newPos = beforeAt.length + `((${placeholder}))`.length;
					setCaretPosition(editor, newPos);
				}
				hidePlaceholderDropdown();
			};
			
			function getCaretPosition(element) {
				const selection = window.getSelection();
				if (selection.rangeCount > 0) {
					const range = selection.getRangeAt(0);
					const preCaretRange = range.cloneRange();
					preCaretRange.selectNodeContents(element);
					preCaretRange.setEnd(range.endContainer, range.endOffset);
					return preCaretRange.toString().length;
				}
				return 0;
			}
			
			function setCaretPosition(element, position) {
				const range = document.createRange();
				const selection = window.getSelection();
				const textNode = element.firstChild || element;
				range.setStart(textNode, Math.min(position, textNode.length));
				range.collapse(true);
				selection.removeAllRanges();
				selection.addRange(range);
			}
		})();

		// Authentication Modal Setup
		(function() {
			const authModal = document.getElementById('authModal');
			const modalGoogleLoginBtn = document.getElementById('modalGoogleLoginBtn');
			const modalUploadCredentialsBtn = document.getElementById('modalUploadCredentialsBtn');
			const modalCredentialsFile = document.getElementById('modalCredentialsFile');
			const selectedFileName = document.getElementById('selectedFileName');

			// Show auth modal when login button is clicked
			if (modalGoogleLoginBtn) {
				modalGoogleLoginBtn.addEventListener('click', async () => {
					try {
						// Use default credentials for Google OAuth
						const result = await window.electronAPI.authenticateGoogle({});
						if (result.success) {
							authModal.style.display = 'none';
							showSuccess('Authentication successful! Setting up services...');
						} else {
							showError('Authentication failed: ' + result.error);
						}
					} catch (error) {
						showError('Authentication error: ' + error.message);
					}
				});
			}

			// Handle credentials file selection
			if (modalUploadCredentialsBtn) {
				modalUploadCredentialsBtn.addEventListener('click', () => {
					modalCredentialsFile.click();
				});
			}

			// Handle file selection
			if (modalCredentialsFile) {
				modalCredentialsFile.addEventListener('change', async (e) => {
					const file = e.target.files[0];
					if (file) {
						selectedFileName.textContent = `Selected: ${file.name}`;
						
						try {
							const credentials = await readCredentialsFile(file);
							const result = await window.electronAPI.authenticateGoogle(credentials);
							if (result.success) {
								authModal.style.display = 'none';
								showSuccess('Credentials uploaded successfully! Setting up services...');
							} else {
								showError('Authentication failed: ' + result.error);
							}
						} catch (error) {
							showError('Failed to process credentials: ' + error.message);
						}
					}
				});
			}

			// Helper function to read credentials file
			function readCredentialsFile(file) {
				return new Promise((resolve, reject) => {
					const reader = new FileReader();
					reader.onload = (e) => {
						try {
							const credentials = JSON.parse(e.target.result);
							resolve(credentials);
						} catch (error) {
							reject(new Error('Invalid JSON file'));
						}
					};
					reader.onerror = () => reject(new Error('Failed to read file'));
					reader.readAsText(file);
				});
			}
		})();
		
		// Enhanced Theme Toggle
		(function() {
			const themeToggle = document.getElementById('themeToggle');
			const body = document.body;
			
			// Load saved theme
			const savedTheme = localStorage.getItem('theme') || 'light';
			body.classList.add(`theme-${savedTheme}`);
			updateThemeIcon(savedTheme);
			
			themeToggle.addEventListener('click', function() {
				const currentTheme = body.classList.contains('theme-dark') ? 'dark' : 'light';
				const newTheme = currentTheme === 'light' ? 'dark' : 'light';
				
				body.classList.remove(`theme-${currentTheme}`);
				body.classList.add(`theme-${newTheme}`);
				
				localStorage.setItem('theme', newTheme);
				updateThemeIcon(newTheme);
				
				// Show notification
				showNotification(`Switched to ${newTheme} theme`, 'info');
			});
			
			function updateThemeIcon(theme) {
				const icon = themeToggle.querySelector('i');
				if (icon) {
					icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
				}
			}
		})();
		
		// Enhanced Notification System
		window.showNotification = function(message, type = 'info', duration = 10000) {
			const notification = document.createElement('div');
			notification.className = `notification notification-${type}`;
			notification.innerHTML = `
				${message}
				<button class="close-btn" onclick="this.parentElement.remove()">&times;</button>
			`;
			
			document.body.appendChild(notification);
			
			// Show notification
			setTimeout(() => notification.classList.add('show'), 100);
			
			// Auto-hide after duration (unless hovered)
			let hideTimeout = setTimeout(() => {
				if (notification.parentElement) {
					notification.classList.remove('show');
					setTimeout(() => notification.remove(), 300);
				}
			}, duration);
			
			// Pause auto-hide on hover
			notification.addEventListener('mouseenter', () => {
				clearTimeout(hideTimeout);
			});
			
			notification.addEventListener('mouseleave', () => {
				hideTimeout = setTimeout(() => {
					if (notification.parentElement) {
						notification.classList.remove('show');
						setTimeout(() => notification.remove(), 300);
					}
				}, 10000); // 10 seconds after leaving
			});
		};

		// Notification helper functions for the app
		window.showSuccess = function(message) {
			window.showNotification(message, 'success', 5000);
		};

		window.showError = function(message) {
			window.showNotification(message, 'error', 8000);
		};

		window.showWarning = function(message) {
			window.showNotification(message, 'warning', 6000);
		};

		window.showInfo = function(message) {
			window.showNotification(message, 'info', 4000);
		};

		// Main App Initialization
		document.addEventListener('DOMContentLoaded', function() {
			// Initialize theme
			initializeTheme();
			
			// Setup placeholder system
			setupPlaceholderSystem();
			
			// Setup authentication modal - wait for RTX app to be ready
			setTimeout(() => {
				if (window.rtxApp && window.rtxApp.setupAuthenticationModal) {
					window.rtxApp.setupAuthenticationModal();
				} else {
					console.warn('RTX App not ready yet, retrying...');
					setTimeout(() => {
						if (window.rtxApp && window.rtxApp.setupAuthenticationModal) {
							window.rtxApp.setupAuthenticationModal();
						}
					}, 1000);
				}
			}, 100);
			
			// Setup event listeners
			setupEventListeners();
			
			// Initialize tab system
			initializeTabSystem();
		});

		// Helper functions for app initialization
		function initializeTheme() {
			const savedTheme = localStorage.getItem('theme') || 'light';
			document.body.classList.add(`theme-${savedTheme}`);
			updateThemeIcon(savedTheme);
		}

		function setupPlaceholderSystem() {
			// Placeholder system is already initialized in the IIFE above
		}

		function setupEventListeners() {
			// Connect main authentication buttons to show modal
			const googleLoginBtn = document.getElementById('googleLoginBtn');
			const uploadCredentialsBtn = document.getElementById('uploadCredentialsBtn');
			const credentialsFile = document.getElementById('credentialsFile');

			if (googleLoginBtn) {
				googleLoginBtn.addEventListener('click', () => {
					document.getElementById('authModal').style.display = 'block';
				});
			}

			if (uploadCredentialsBtn) {
				uploadCredentialsBtn.addEventListener('click', () => {
					credentialsFile.click();
				});
			}

			if (credentialsFile) {
				credentialsFile.addEventListener('change', async (e) => {
					const file = e.target.files[0];
					if (file) {
						try {
							const credentials = await readCredentialsFile(file);
							const result = await window.electronAPI.authenticateGoogle(credentials);
							if (result.success) {
								showSuccess('Credentials uploaded successfully! Setting up services...');
							} else {
								showError('Authentication failed: ' + result.error);
							}
						} catch (error) {
							showError('Failed to process credentials: ' + error.message);
						}
					}
				});
			}
		}

		function initializeTabSystem() {
			// Tab system is already initialized in the IIFE above
		}

		function updateThemeIcon(theme) {
			const themeToggle = document.getElementById('themeToggle');
			if (themeToggle) {
				const icon = themeToggle.querySelector('i');
				if (icon) {
					icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
				}
			}
		}

		// Signature management functionality
		function setupSignatureManagement() {
			// Load saved signatures on page load
			loadSignaturesList();
		}
		
		async function saveSignature() {
			try {
				const nameInput = document.getElementById('signatureName');
				const editor = document.getElementById('signatureEditor');
				
				if (!nameInput || !editor) {
					alert('Signature elements not found');
					return;
				}
				
				const name = nameInput.value.trim();
				if (!name) {
					alert('Please enter a signature name');
					return;
				}
				
				const content = editor.innerHTML;
				if (!content || content.trim() === '') {
					alert('Please enter signature content');
					return;
				}
				
				if (!window.electronAPI || !window.electronAPI.saveSignature) {
					alert('Signature saving not available');
					return;
				}
				
				const result = await window.electronAPI.saveSignature({
					name: name,
					html: content,
					text: editor.textContent || ''
				});
				
				if (result.success) {
					alert('Signature saved successfully!');
					loadSignaturesList(); // Refresh the list
				} else {
					alert('Failed to save signature: ' + (result.error || 'Unknown error'));
				}
			} catch (error) {
				console.error('Error saving signature:', error);
				alert('Error saving signature: ' + error.message);
			}
		}
		
		async function loadSignature() {
			try {
				if (!window.electronAPI || !window.electronAPI.signaturesList) {
					alert('Signature loading not available');
					return;
				}
				
				const result = await window.electronAPI.signaturesList();
				if (!result.success || !result.signatures || result.signatures.length === 0) {
					alert('No saved signatures found');
					return;
				}
				
				// Show signatures list
				showSignaturesList(result.signatures);
			} catch (error) {
				console.error('Error loading signatures:', error);
				alert('Error loading signatures: ' + error.message);
			}
		}
		
		function clearSignature() {
			const nameInput = document.getElementById('signatureName');
			const editor = document.getElementById('signatureEditor');
			
			if (nameInput) nameInput.value = '';
			if (editor) editor.innerHTML = '';
		}
		
		async function loadSignaturesList() {
			try {
				if (!window.electronAPI || !window.electronAPI.signaturesList) {
					return;
				}
				
				const result = await window.electronAPI.signaturesList();
				if (result.success && result.signatures && result.signatures.length > 0) {
					showSignaturesList(result.signatures);
				}
			} catch (error) {
				console.error('Error loading signatures list:', error);
			}
		}
		
		function showSignaturesList(signatures) {
			const container = document.getElementById('signaturesContainer');
			const listDiv = document.getElementById('signaturesList');
			
			if (!container || !listDiv) return;
			
			listDiv.style.display = 'block';
			
			container.innerHTML = signatures.map(sig => `
				<div style="display:flex; justify-content:space-between; align-items:center; padding:8px; border:1px solid #e5e5e7; border-radius:6px; margin-bottom:8px; background:#fff;">
					<div>
						<strong>${sig.name}</strong>
						<small style="color:#8E8E93; margin-left:8px;">${new Date(sig.created).toLocaleDateString()}</small>
					</div>
					<div style="display:flex; gap:4px;">
						<button onclick="loadSignatureContent('${sig.path}')" style="padding:4px 8px; background:#007AFF; color:white; border:none; border-radius:4px; cursor:pointer; font-size:12px;">Load</button>
						<button onclick="deleteSignature('${sig.path}')" style="padding:4px 8px; background:#FF3B30; color:white; border:none; border-radius:4px; cursor:pointer; font-size:12px;">Delete</button>
					</div>
				</div>
			`).join('');
		}
		
				async function loadSignatureContent(signaturePath) {
			try {
				if (!window.electronAPI || !window.electronAPI.loadSignature) {
					alert('Signature loading not available');
					return;
				}
				
				const result = await window.electronAPI.loadSignature(signaturePath);
				if (result.success && result.signature) {
					const nameInput = document.getElementById('signatureName');
					const editor = document.getElementById('signatureEditor');
					
					if (nameInput) nameInput.value = result.signature.name;
					if (editor) editor.innerHTML = result.signature.html || result.signature.text || '';
					
					alert('Signature loaded successfully!');
				} else {
					alert('Failed to load signature: ' + (result.error || 'Unknown error'));
				}
			} catch (error) {
				console.error('Error loading signature content:', error);
				alert('Error loading signature: ' + error.message);
			}
		}

		// Function to get current signature content and apply it to email
		function getCurrentSignatureContent() {
			const signatureEditor = document.getElementById('signatureEditor');
			if (signatureEditor && signatureEditor.innerHTML.trim()) {
				return signatureEditor.innerHTML.trim();
			}
			return '';
		}

		// Function to apply signature to email editor
		function applySignatureToEmail() {
			const emailEditor = document.getElementById('emailEditor');
			const signatureContent = getCurrentSignatureContent();
			
			if (!emailEditor || !signatureContent) {
				alert('No signature content to apply or email editor not found');
				return;
			}
			
			// Insert signature at the end of the email
			const signatureHtml = '<br><br>' + signatureContent;
			emailEditor.innerHTML += signatureHtml;
			
			// Move cursor to end
			const range = document.createRange();
			const sel = window.getSelection();
			range.selectNodeContents(emailEditor);
			range.collapse(false);
			sel.removeAllRanges();
			sel.addRange(range);
			emailEditor.focus();
			
			alert('Signature applied to email!');
		}
		
		async function deleteSignature(signaturePath) {
			try {
				if (!confirm('Are you sure you want to delete this signature?')) {
					return;
				}
				
				if (!window.electronAPI || !window.electronAPI.signaturesDelete) {
					alert('Signature deletion not available');
					return;
				}
				
				const result = await window.electronAPI.signaturesDelete(signaturePath);
				if (result.success) {
					alert('Signature deleted successfully!');
					loadSignaturesList(); // Refresh the list
				} else {
					alert('Failed to delete signature: ' + (result.error || 'Unknown error'));
				}
			} catch (error) {
				console.error('Error deleting signature:', error);
				alert('Error deleting signature: ' + error.message);
			}
		}
	</script>
</body>
</html> 